@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml
LAYOUT_LEFT_RIGHT()

title Diagrama de Componentes - Sistema Clínica UNFV

' === Actores ===
Person(paciente, "Paciente", "Usuario final")
Person(personal, "Personal Clínico", "Médicos y administrativos")

' === Presentación ===
Container_Boundary(front, "Presentación") {
  Component(portal, "Portal Web", "React", "Citas y consultas")
  Component(desktop, "Sistema Desktop", ".NET", "Gestión clínica")
}

' === Servicios Core ===
Container_Boundary(core, "Servicios Core") {
  Component(auth, "Autenticación", "JWT", "Seguridad y roles")
  Component(citas, "Gestión Citas", ".NET API", "Programación citas")
  Component(hc, "Historia Clínica", ".NET API", "Gestión HC")
  Component(farm, "Farmacia", ".NET API", "Inventario medicamentos")
  Component(img, "Diagnóstico", ".NET API", "Estudios imágenes")
  ComponentDb(db, "Base Datos", "SQL Server", "Persistencia")
}

' === Sistemas Externos ===
System_Ext(pacs, "PACS/RIS", "Imágenes médicas")
System_Ext(sunat, "SUNAT", "Facturación electrónica")
System_Ext(seguros, "Seguros", "SIS, EPS")

' === Relaciones Principales ===
Rel(paciente, portal, "Usa")
Rel(personal, desktop, "Usa")

Rel(portal, auth, "Login")
Rel(desktop, auth, "Login")

Rel(portal, citas, "Solicita citas", "REST")
Rel(desktop, hc, "Gestiona HC", "REST")
Rel(desktop, farm, "Dispensa", "REST")

' === Relaciones de Datos ===
Rel(auth, db, "Usuarios")
Rel(citas, db, "Citas")
Rel(hc, db, "Historias")
Rel(farm, db, "Inventario")
Rel(img, db, "Metadatos")

' === Integraciones Externas ===
Rel(img, pacs, "DICOM")
Rel(desktop, sunat, "Facturación")
Rel(citas, seguros, "Cobertura")

' === Interfaces Clave ===
Rel(citas, hc, "<<interface>>\nActualizaHC", "usa")
Rel(hc, farm, "<<interface>>\nRecetaMedica", "usa")
Rel(img, hc, "<<interface>>\nResultadoEstudio", "actualiza")

@enduml